<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://rawgit.com/jeromeetienne/AR.js/1.7.2/aframe/build/aframe-ar.min.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
      
      <!-- MARCADOR -->
      <a-marker preset="custom" type="pattern" url="marker1.patt" id="marker">

        <!-- Grupo que contiene la pluma y las tarjetas -->
        <a-entity id="grupoCompleto" position="0 0 0" rotation="-90 0 0">
          
          <!-- Imagen central (Pluma) -->
          <a-image id="pluma" src="pen.png" position="0 0 0" scale="1 1 1" opacity="1">
            <a-animation attribute="opacity" to="1" dur="1000"></a-animation>
          </a-image>

          <!-- Tarjetas -->
          <a-image id="tarjeta1" src="card.png" position="-1 0.5 0" scale="0 0 0"></a-image>
          <a-image id="tarjeta2" src="card.png" position="-1 -0.5 0" scale="0 0 0"></a-image>
          <a-image id="tarjeta3" src="card.png" position="1 0.5 0" scale="0 0 0"></a-image>
          <a-image id="tarjeta4" src="card.png" position="1 -0.5 0" scale="0 0 0"></a-image>

        </a-entity>

      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      document.querySelector("#marker").addEventListener("markerFound", () => {
        console.log("Marcador detectado. Activando animaciones.");

        let tarjetas = [
          { id: "tarjeta1", audio: new Audio("_audio1.wav") },
          { id: "tarjeta2", audio: new Audio("_audio2.wav") },
          { id: "tarjeta3", audio: new Audio("_audio3.wav") },
          { id: "tarjeta4", audio: new Audio("_audio4.wav") },
        ];

        let index = 0;

        function mostrarTarjetaYReproducirAudio() {
          if (index >= tarjetas.length) return;
          
          let tarjeta = tarjetas[index];
          let elemento = document.querySelector(`#${tarjeta.id}`);

          console.log(`Mostrando ${tarjeta.id}`);

          // Activar la animación de la tarjeta
          elemento.setAttribute("scale", "0.5 0.5 0.5");

          // Intentar reproducir el audio
          tarjeta.audio.play().catch(error => console.warn("Error reproduciendo audio:", error));

          tarjeta.audio.onended = () => {
            console.log(`Audio de ${tarjeta.id} terminado.`);
            index++;
            mostrarTarjetaYReproducirAudio();
          };
        }

        // Iniciar animación y sonido con retraso
        setTimeout(() => {
          mostrarTarjetaYReproducirAudio();
        }, 1000);

        // Aplicar rotación al grupo completo (pluma y tarjetas)
        let grupo = document.querySelector("#grupoCompleto");
        grupo.setAttribute("rotation", "0 180 0"); // Ajusta la rotación según necesites
      });
    </script>
  </body>
</html>
