<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://rawgit.com/jeromeetienne/AR.js/1.7.2/aframe/build/aframe-ar.min.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
      
      <!-- MARCADOR (Se activa con un marcador de AR.js) -->
      <a-marker preset="custom" type="pattern" url="marker1.patt" id="marker">

        <!-- Contenedor para ajustar la rotación y posición -->
        <a-entity id="grupo" position="0 0 0" rotation="-90 0 0">
          
          <!-- Imagen central (Pluma) -->
          <a-image id="pluma" src="pen.png" position="0 0 0" scale="1 1 1" opacity="1">
            <a-animation attribute="opacity" to="1" begin="markerFound" dur="1000"></a-animation>
          </a-image>

          <!-- Textura 1 (Izquierda arriba) -->
          <a-image id="textura1" src="ring.png" position="-1 0.5 0" scale="1 1 1" opacity="0" transparent="true">
            <a-animation attribute="opacity" to="1" begin="textura1-visible" dur="1000"></a-animation>
            <a-animation attribute="opacity" to="0" begin="textura1-oculta" dur="1000"></a-animation>
          </a-image>

          <!-- Textura 2 (Izquierda abajo) -->
          <a-image id="textura2" src="ring.png" position="-1 -0.5 0" scale="1 1 1" opacity="0" transparent="true">
            <a-animation attribute="opacity" to="1" begin="textura2-visible" dur="1000"></a-animation>
            <a-animation attribute="opacity" to="0" begin="textura2-oculta" dur="1000"></a-animation>
          </a-image>

          <!-- Textura 3 (Derecha arriba) -->
          <a-image id="textura3" src="ring.png" position="1 0.5 0" scale="1 1 1" opacity="0" transparent="true">
            <a-animation attribute="opacity" to="1" begin="textura3-visible" dur="1000"></a-animation>
            <a-animation attribute="opacity" to="0" begin="textura3-oculta" dur="1000"></a-animation>
          </a-image>

          <!-- Textura 4 (Derecha abajo) -->
          <a-image id="textura4" src="ring.png" position="1 -0.5 0" scale="1 1 1" opacity="0" transparent="true">
            <a-animation attribute="opacity" to="1" begin="textura4-visible" dur="1000"></a-animation>
            <a-animation attribute="opacity" to="0" begin="textura4-oculta" dur="1000"></a-animation>
          </a-image>

        </a-entity>

      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      let currentTextureIndex = 0; // Índice de la textura actual
      let textures = []; // Array para almacenar las texturas

      // Inicializar las texturas cuando el DOM esté listo
      document.addEventListener("DOMContentLoaded", () => {
        textures = [
          document.querySelector("#textura1"),
          document.querySelector("#textura2"),
          document.querySelector("#textura3"),
          document.querySelector("#textura4"),
        ];
      });

      // Evento cuando se detecta el marcador
      document.querySelector("#marker").addEventListener("markerFound", () => {
        console.log("Marcador detectado"); // Debug

        // Comenzar la secuencia de texturas
        mostrarTexturasSecuenciales();
      });

      // Evento cuando se pierde el marcador
      document.querySelector("#marker").addEventListener("markerLost", () => {
        console.log("Marcador perdido"); // Debug

        // Ocultar todas las texturas cuando el marcador se pierde
        ocultarTexturas();
      });

      // Función para ocultar todas las texturas
      function ocultarTexturas() {
        textures.forEach(texture => {
          texture.emit("oculta"); // Oculta la textura
        });
        currentTextureIndex = 0; // Reiniciar el índice de la textura actual
      }

      // Función para mostrar las texturas secuencialmente
      function mostrarTexturasSecuenciales() {
        if (currentTextureIndex >= textures.length) {
          currentTextureIndex = 0; // Reiniciar la secuencia si se llega al final
        }

        const texture = textures[currentTextureIndex];

        // Mostrar la textura actual
        texture.emit("visible");

        // Ocultar la textura actual después de un tiempo y pasar a la siguiente
        setTimeout(() => {
          texture.emit("oculta"); // Oculta la textura actual
          currentTextureIndex++; // Pasar a la siguiente textura
          mostrarTexturasSecuenciales(); // Mostrar la siguiente textura
        }, 2000); // Tiempo que la textura permanece visible (2 segundos)
      }
    </script>
  </body>
</html>
