<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://rawgit.com/jeromeetienne/AR.js/1.7.2/aframe/build/aframe-ar.min.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
      
      <!-- MARCADOR (Se activa con un marcador de AR.js) -->
      <a-marker preset="custom" type="pattern" url="marker1.patt" id="marker">

        <!-- Contenedor para ajustar la rotación y posición -->
        <a-entity id="grupo" position="0 0 0" rotation="-90 0 0">
          
          <!-- Imagen central (Pluma) -->
          <a-image id="pluma" src="pen.png" position="0 0 0" scale="1 1 1" opacity="1">
            <a-animation attribute="opacity" to="1" begin="markerFound" dur="1000"></a-animation>
          </a-image>

          <!-- Video 1 (Izquierda arriba) -->
          <a-video id="video1" src="toGif.mp4" position="-1 0.5 0" scale="1 1 1" opacity="1" autoplay="false">
            <a-animation attribute="opacity" to="1" begin="markerFound" dur="1000"></a-animation>
          </a-video>

          <!-- Video 2 (Izquierda abajo) -->
          <a-video id="video2" src="toGif_2.mp4" position="-1 -0.5 0" scale="1 1 1" opacity="1" autoplay="false">
            <a-animation attribute="opacity" to="1" begin="markerFound" dur="1000"></a-animation>
          </a-video>

          <!-- Video 3 (Derecha arriba) -->
          <a-video id="video3" src="toGif_4.mp4" position="1 0.5 0" scale="1 1 1" opacity="1" autoplay="false">
            <a-animation attribute="opacity" to="1" begin="markerFound" dur="1000"></a-animation>
          </a-video>

          <!-- Video 4 (Derecha abajo) -->
          <a-video id="video4" src="Preview1.mp4" position="1 -0.5 0" scale="1 1 1" opacity="1" autoplay="false">
            <a-animation attribute="opacity" to="1" begin="markerFound" dur="1000"></a-animation>
          </a-video>

        </a-entity>

      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      document.querySelector("#marker").addEventListener("markerFound", () => {
        console.log("Marcador detectado"); // Debug

        // Comenzar la secuencia de reproducción de videos
        reproducirVideosSecuenciales();
      });

      document.querySelector("#marker").addEventListener("markerLost", () => {
        console.log("Marcador perdido"); // Debug

        // Pausar todos los videos cuando el marcador se pierde
        pausarVideos();
      });

      function pausarVideos() {
        let videos = [
          document.querySelector("#video1"),
          document.querySelector("#video2"),
          document.querySelector("#video3"),
          document.querySelector("#video4"),
        ];

        // Pausar todos los videos
        videos.forEach(video => {
          video.setAttribute("autoplay", "false");
          video.pause();
        });
      }

      function reproducirVideosSecuenciales() {
        let videos = [
          { id: "video1", element: document.querySelector("#video1") },
          { id: "video2", element: document.querySelector("#video2") },
          { id: "video3", element: document.querySelector("#video3") },
          { id: "video4", element: document.querySelector("#video4") },
        ];

        let index = 0;

        function reproducirSiguiente() {
          if (index >= videos.length) return; // Terminar si ya no hay más videos
          let video = videos[index];

          // Agrandar el video
          video.element.setAttribute("scale", "1.2 1.2 1");

          // Reproducir video
          video.element.play();

          // Cuando termine el video
          video.element.addEventListener('ended', () => {
            // Reducir el tamaño del video
            video.element.setAttribute("scale", "1 1 1");

            // Ir al siguiente video
            index++;
            reproducirSiguiente(); // Pasar al siguiente
          });
        }

        // Comenzar con el primero
        setTimeout(() => {
          reproducirSiguiente();
        }, 1000); // Espera antes de iniciar el primer video
      }
    </script>
  </body>
</html>
